<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–ö–ª–∏–µ–Ω—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π</title>

  <!-- YAML-–ø–∞—Ä—Å–µ—Ä -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <!-- –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä PPTX -->
  <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>

  <style>
    :root {
      --bg: #f7f9fb;
      --card-bg: #fff;
      --text: #0a1f33;
      --accent: #2b8cff;
      --muted: #7a7e91;
      --radius: 16px;
      --shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
      --font: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }
    body {
      margin: 0;
      background: var(--bg);
      font-family: var(--font);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: var(--card-bg);
      box-shadow: var(--shadow);
      padding: 1.2rem 2rem;
      font-weight: 600;
      font-size: 1.25rem;
    }
    main {
      flex: 1;
      padding: 2rem;
      max-width: 1100px;
      margin: 0 auto;
    }
    h1 {
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    .filters {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 2rem;
    }
    select, input {
      padding: 0.6rem 1rem;
      border-radius: var(--radius);
      border: 1px solid #d5dae2;
      font-family: var(--font);
      background: #fff;
      font-size: 1rem;
      outline: none;
    }
    button {
      padding: 0.7rem 1.4rem;
      border: none;
      border-radius: var(--radius);
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: #195ee9; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    .card:hover { transform: translateY(-4px); }
    .thumb {
      width: 100%;
      height: 180px;
      background: #eef2f8;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 500;
      object-fit: cover;
    }
    .content { padding: 1rem 1.2rem; }
    .taglist {
      margin-top: 0.4rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }
    .tag {
      background: #eef3fb;
      color: var(--accent);
      border-radius: 999px;
      font-size: 0.8rem;
      padding: 0.2rem 0.6rem;
    }
    footer {
      text-align: center;
      font-size: 0.9rem;
      color: var(--muted);
      padding: 1rem;
    }
    .actions { margin-top: .8rem; display:flex; gap:.5rem; flex-wrap:wrap; }
    textarea {
      width: 100%;
      height: 260px;
      border: 1px solid #d5dae2;
      border-radius: 12px;
      padding: .8rem;
      font-family: ui-monospace, Menlo, Consolas, monospace;
      background:#fff;
    }
  </style>
</head>
<body>
  <header>–ö–ª–∏–µ–Ω—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π</header>

  <main>
    <h1>–í—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤</h1>

    <div class="filters">
      <select id="audience">
        <option value="">–ê—É–¥–∏—Ç–æ—Ä–∏—è</option>
        <option>–∏–Ω–≤–µ—Å—Ç–æ—Ä—ã</option>
        <option>–∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∏</option>
        <option>—Å—Ç—É–¥–µ–Ω—Ç—ã</option>
        <option>–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç</option>
        <option>–º–∞—Ä–∫–µ—Ç–∏–Ω–≥</option>
      </select>

      <input id="purpose" placeholder="–¶–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –ø–∏—Ç—á)" />
      <input id="tags" placeholder="–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: ESG, –≤–æ–¥–∞)" />

      <button id="search">–ü–æ–¥–æ–±—Ä–∞—Ç—å</button>
    </div>

    <div id="results" class="grid"></div>
  </main>

  <footer>¬© 2025 –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏</footer>

  <!-- —Ç–≤–æ–π –∑–∞–≥—Ä—É–∑—á–∏–∫ YAML + —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è -->
  <script src="scripts/loader.js"></script>

  <!-- –º–æ–¥—É–ª—å: –≤—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–∞ + –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PPTX -->
  <script type="module">
    import { generateFromForm } from './scripts/generator.js';

    const resultsEl = document.getElementById('results');
    const btn = document.getElementById('search');

    let cachedConfig = null;
    let lastSelectedTemplate = null;

    async function ensureConfig() {
      if (!cachedConfig) cachedConfig = await loadPresets();
      return cachedConfig;
    }

    function renderCards(found) {
      resultsEl.innerHTML = '';
      if (!found.length) {
        resultsEl.innerHTML = '<p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ü´•</p>';
        return;
      }
      found.forEach((t, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        const thumb = t.thumb
          ? `<img src="${t.thumb}" alt="${t.name}" class="thumb" />`
          : `<div class="thumb">–ë–µ–∑ –ø—Ä–µ–≤—å—é</div>`;
        const tagsHTML = (t.tags || []).map(tag => `<span class="tag">${tag}</span>`).join('');
        card.innerHTML = `
          ${thumb}
          <div class="content">
            <h3>${t.name}</h3>
            <p style="color:var(--muted);font-size:0.9rem;">${t.style}</p>
            <div class="taglist">${tagsHTML}</div>
            <div class="actions">
              <button data-choose="${i}">–í—ã–±—Ä–∞—Ç—å —ç—Ç–æ—Ç</button>
            </div>
          </div>
        `;
        resultsEl.appendChild(card);
      });

      resultsEl.querySelectorAll('button[data-choose]').forEach(b => {
        b.addEventListener('click', e => {
          const idx = parseInt(e.currentTarget.getAttribute('data-choose'), 10);
          lastSelectedTemplate = found[idx];
          renderComposer();
        });
      });
    }

    function renderComposer() {
      // –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–π –∫–æ–º–ø–æ–∑–µ—Ä, –µ—Å–ª–∏ –±—ã–ª
      const old = document.getElementById('composer');
      if (old) old.remove();

      const wrap = document.createElement('div');
      wrap.id = 'composer';
      wrap.className = 'card';
      wrap.style.padding = '1rem 1.2rem';
      wrap.style.gridColumn = '1 / -1';
      wrap.innerHTML = `
        <h3 style="margin:0 0 .6rem 0">–ö–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ (JSON)</h3>
        <p style="margin:.2rem 0 .8rem 0;color:var(--muted);font-size:.95rem">
          –°—Ö–µ–º–∞: { "fileName": "...", "title": "...", "subtitle": "...", "slides":[
            { "type":"bullets","title":"...","bullets":["..."] },
            { "type":"two_column","title":"...","col_left":"...","col_right":"..." },
            { "type":"quote","quote_text":"...","author":"..." },
            { "type":"closing","title":"–°–ø–∞—Å–∏–±–æ!","cta":"–í–æ–ø—Ä–æ—Å—ã?" }
          ]}
        </p>
        <textarea id="content-json"></textarea>
        <div class="actions">
          <button id="use-demo">–í—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä</button>
          <button id="build-pptx" style="background:#0ea5e9">–°–æ–±—Ä–∞—Ç—å .pptx</button>
        </div>
      `;
      resultsEl.appendChild(wrap);

      const demo = {
        fileName: "demo_presentation",
        title: "–ü—Ä–æ–±–ª–µ–º—ã –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –†–æ—Å—Å–∏–∏",
        subtitle: "–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –Ω–∞–ª–∏—á–Ω—ã—Ö –∏ –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã—Ö, —Ü–∏—Ñ—Ä–æ–≤–æ–π —Ä—É–±–ª—å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¶–ë",
        slides: [
          { type: "section", title: "–î–∏–Ω–∞–º–∏–∫–∞ –Ω–∞–ª–∏—á–Ω—ã—Ö –∏ –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤" },
          { type: "bullets", title: "–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–∫—Ç—ã", bullets: [
            "2018: ~70% –±–µ–∑–Ω–∞–ª–∞ (–ø–æ —á–∏—Å–ª—É –æ–ø–µ—Ä–∞—Ü–∏–π)",
            "2023: ~86.5%",
            "–≠–∫—Å–ø–∞–Ω—Å–∏—è –±–µ–∑–Ω–∞–ª–∏—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π"
          ]},
          { type: "two_column", title: "–¶–∏—Ñ—Ä–æ–≤–æ–π —Ä—É–±–ª—å",
            col_left: "–ó–∞–¥–∞—á–∏: —Å–∫–æ—Ä–æ—Å—Ç—å, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, —Å–Ω–∏–∂–µ–Ω–∏–µ –∏–∑–¥–µ—Ä–∂–µ–∫",
            col_right: "–†–∏—Å–∫–∏: –∫–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å, –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä—ã–Ω–∫–æ–º"
          },
          { type: "quote", quote_text: "–î–µ–Ω—å–≥–∏ ‚Äî —ç—Ç–æ –¥–æ–≥–æ–≤–æ—Ä –¥–æ–≤–µ—Ä–∏—è", author: "–ê–Ω–æ–Ω–∏–º–Ω—ã–π —ç–∫–æ–Ω–æ–º–∏—Å—Ç" },
          { type: "closing", title: "–°–ø–∞—Å–∏–±–æ!", cta: "–í–æ–ø—Ä–æ—Å—ã?" }
        ]
      };

      const ta = wrap.querySelector('#content-json');
      wrap.querySelector('#use-demo').addEventListener('click', () => {
        ta.value = JSON.stringify(demo, null, 2);
      });
      wrap.querySelector('#build-pptx').addEventListener('click', async () => {
        if (!lastSelectedTemplate) {
          alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —à–∞–±–ª–æ–Ω.');
          return;
        }
        const cfg = await ensureConfig();
        await generateFromForm(cfg, lastSelectedTemplate, ta.value || "{}");
      });
    }

    async function runSearch() {
      const audience = document.getElementById('audience').value
        ? [document.getElementById('audience').value] : [];
      const purpose = document.getElementById('purpose').value.trim();
      const tags = document.getElementById('tags').value
        .split(',').map(t => t.trim()).filter(Boolean);

      const config = await ensureConfig();
      const found = findTemplates(config, { audience, purpose, tags });
      renderCards(found);
    }

    btn.addEventListener('click', runSearch);
  </script>
</body>
</html>
